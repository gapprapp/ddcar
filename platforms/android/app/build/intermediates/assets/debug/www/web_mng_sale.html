<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>รายงานการขาย</title>

    <!-- Bootstrap Import -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css" integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ"
        crossorigin="anonymous">

    <!-- Super cool dialog-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js"></script>

    <!-- Loading -->
    <link rel="stylesheet" href="css/easy-loading.css">
    <script src="js/easy-loading.js"></script>

    <!-- Date Picker -->
    <link href="css/datepicker.css" rel="stylesheet">
    <script src="js/datepicker.js"></script>
    <script src="js/datepicker.th-TH.js"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Prompt" rel="stylesheet">
    <!-- Main -->
    <link href="css/untitled.css" rel="stylesheet">
    <style>
        body{color: #666;}
    a{ color: #999;}
    a:hover{color: #666;}
    .active{color: #666;}
    .sale-odd, .sale-even{
      padding-top: 1%; padding-bottom: 1%; color: #fff; margin-bottom: 1%; cursor: pointer;
    }
    .sale-odd{
      background-color: #999;
    }
    .sale-even{
      background-color: #858585;
    }
    h5{
      letter-spacing: 2px;
    }
    ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }
    div[id^="detail"]{
        margin-bottom: 0.8em;
    }
    .items{
        font-size: 120%;
    }
    div[id^="item-"]{
        margin-top: 0.5em;
    }
  </style>
  <script>
      $(document).ready(function () {
        // datepicker
        $('[data-toggle="datepicker"]').datepicker({
            language: 'th-TH',
            format: 'yyyy-mm-dd',
            autoHide: true
        }).on('pick.datepicker', function (e) {
            arr = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
            edate = e.date.toString()
            d = edate.split(" ")
            day = d[2]
            year = d[3]
            month = arr.indexOf(d[1])
            date = year + "-" + (month+1) + "-" + day
            search_date(date); 
        });

        var d = new Date($.now());
        var datetime = d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate(); 
        search_date(datetime); 
      });

      function search_date(datetime){
        $('#ctn-top').empty()
        $('#myUL').empty();
        $.ajax({
            type: "POST",
            url:"php/get_shift_bill.php",
            data:{'date':datetime},
            beforeSend: function(){
                EasyLoading.show({                           
                    text: "กำลังโหลด"
                });
            },                       
            success: function(data){ 
                EasyLoading.hide();                
                var obj = jQuery.parseJSON(data);
                if(obj){
                    var net = 0,profit = 0;
                    $.each(obj, function(i, field){
                        if(field.total_price == 0){
                            sum = 0;
                        }else{
                            sum = field.total_price - field.count;
                        }                        
                    $('#myUL').append('<li id="sale-'+field.order_id+'">' +
                        '<div class="row justify-content-center sale-even" data-toggle="collapse" href="#detail-'+field.order_id+'" role="button" aria-expanded="false" aria-controls="detail-'+field.order_id+'"onclick="appendCollapse('+field.order_id+');">' +
                            '<div class="col-4 text-center"><h5>'+field.order_number+'</h5></div>' +
                            '<div class="col-2 text-center"><h5>'+field.user_name+'</h5></div>' +
                            '<div class="col-3 text-center"><h5>'+field.total_price+'</h5></div>' +
                            '<div class="col-3 text-center"><h5>'+sum+'</h5></div>' +
                        '</div>' +
                    '</li>');
                        net += parseFloat(field.total_price);
                        profit += parseFloat(sum)
                    });                   
                    $('#ctn-top').append('<div class="col-6 text-right">' +
                                            '<h4>ทั้งหมด : '+net+'</h4>' +
                                        '</div>' +
                                        '<div class="col-6 text-left">' +
                                            '<h4>กำไรสุทธิ : '+profit+'</h4>' +
                                        '</div>');  
                }                                
            }               
        });
    }

        var last_collapse_index = 0;
        function appendCollapse(index){
          if($("#detail-"+index).length){
            if(last_collapse_index){
                $("div").closest("#detail-"+last_collapse_index).collapse('hide');
            }
            if(last_collapse_index != index){
                last_collapse_index = index;
            }
          }else{
            if(last_collapse_index){
                $("div").closest("#detail-"+last_collapse_index).collapse('hide');
            }
                var text = ""        
                $.ajax({
                type: "POST",
                url:"php/get_bill_info4print.php",    
                data:{'bill_id' : index},
                async:false,                            
                beforeSend: function(){
                    EasyLoading.show({                           
                    text: "กำลังโหลด"
                    });
                },             
                success: function(data){  
                    EasyLoading.hide();
                    var obj = jQuery.parseJSON(data);            
                    text = text + '<div class="collapse" id="detail-'+index+'">'+
                    '<div class="card card-body">'+
                    '<div class="row justify-content-center">'+
                        '<h3 style="text-decoration: underline;">รายการ</h3>'+
                    '</div>'
                    $.each(obj, function(i, field){
                    text = text + 
                    '<div id="item-'+field.item_id+'" class="row justify-content-center">'+
                        '<div class="col-1 text-center items">'+field.prod_amount+'</div>'+
                        '<div class="col-7 text-center items">'+field.prod_name+'</div>'+
                        '<div class="col-2 text-center items">'+field.prod_price+'</div>'+
                        '<div class="col-2 text-center items">'+field.prod_price*field.prod_amount+'</div>'+
                    '</div>'
                    });
                    text = text + 
                    '<hr style="width: 50%; margin: auto; margin-top: 1em;">'+
                    '<div class="row" style="margin-top: 1em;">'+
                        '<div class="col-4 text-right"><h5>หมายเหตุ</h5></div>'+
                        '<div class="col-4 text-right">'+obj[0].comment+'<h6></h6></div>'+
                    '</div>'+
                    '<div class="row">'+
                        '<div class="col-4 text-right"><h4>รวม</h4></div>'+
                        '<div class="col-4 text-right"><h4>'+obj[0].sum_price+'</h4></div>'+
                    '</div>'+
                    '<div class="row">'+
                        '<div class="col-4 text-right"><h4>ลด</h4></div>'+
                        '<div class="col-4 text-right"><h4>'+obj[0].total_discount+'</h4></div>'+
                    '</div>'+
                    '<div class="row">'+
                        '<div class="col-4 text-right"><h4>สุทธิ</h4></div>'+
                        '<div class="col-4 text-right"><h4>'+obj[0].total_price+'</h4></div>'+
                    '</div>'+
                    '<div class="row">'+
                        '<div class="col-4 text-right"><h4>รับ / ทอน</h4></div>'+
                        '<div class="col-4 text-right"><h4>'+obj[0].get_price+'</h4></div>'+
                        '<div class="col-4 text-center"><h4>'+obj[0].chng+'</h4></div>'+
                    '</div>'+
                    '<div class="row justify-content-center" style="margin-top: 1em;">'+
                        '<div class="col-4 text-center">'+
                        '<button class="btn btn-lg btn-warning" data-toggle="modal" data-target="#printModal" style="color: white;">พิมพ์รายการ  <i class="fas fa-print"></i></button>'+
                        '</div>'+
                    '</div>'+
                '</div>'+
                '</div>';
                }               
                });       
            
                $("#sale-"+index).append(text);
                $("#btn-a4").attr('onclick', 'printA4('+index+")");
                $("#btn-recep").attr('onclick', 'printRecep('+index+")");

                if(last_collapse_index != index){
                last_collapse_index = index;
                } 
            }
          $('html, body').animate({
                scrollTop: $("#sale-"+index).offset().top
            }, 1100);
      }

        function printA4(index){
      arr_a4 = [];		 
      var text = ""     
      var texta4 = "";
      var c = 1;
      $.ajax({
          type: "POST",
          url:"php/get_bill_info4print.php",    
          data:{'bill_id' : index},
          async:false,                            
          beforeSend: function(){
            EasyLoading.show({                           
              text: "กำลังโหลด"
            });
          },             
          success: function(data){  
            EasyLoading.hide();
            var obj = jQuery.parseJSON(data);
            var dt = obj[0].date_time.split(" ");
            var time = dt[1];
            var day = dt[0].split("-");
            var date = day[2] + "/" + day[1] + "/" + day[0];           
            var credit = obj[0].payment_type.substr(8,2);           
            var d = new Date(day[0],day[1],day[2]);          
            d.setDate(d.getDate() + parseInt(credit));
            var date_ex = d.getDate() + "/" + (d.getMonth()+1) + "/" +   d.getFullYear();           
            text = text + "<html><head><link href='https://fonts.googleapis.com/css?family=Maitree' rel='stylesheet'>" +
              "<style>@media print {body {-webkit-print-color-adjust: exact;}} @page {size: auto; margin: 0;}.fl-spc{float: left; width: 5%;}.fl-9{float: left; width: 9%;}.fl-12{float: left; width: 12.752%;}.fl-13{float: left; width: 13.05%;}.fl-14{float: left; width: 13.88%;}.fl-15{float: left; width: 15%;}.fl-20{float: left; width: 20%; text-align: center;}.fl-25{float: left; width: 25%; text-align: center;}.fl-35{float: left; width: 35%; text-align: center;}.fl-45{float: left; width: 45%; text-align: center;}.fl-80{float: left; width: 80%; text-align: center;}.ctn{position: relative; width: 297mm; height: 10%; padding: 10mm 15mm 0mm 10mm; font-family: 'Maitree';}.tb-st{border: 1px solid black; text-align: center; padding: 3px;}.tb{border: 1px solid black; text-align: center; padding: 3px; border-left: none;}.no-bdt{border-top: none;}.no-bdbtm{border-bottom: none;}.bold{font-weight: bold;}.ccc{background-color: #ccc;}.pd-15{padding-top: 15px;}.pd-16{padding-top: 16px;}.mg-5{margin-top: 5px;}</style></head><body>"
            $.each(obj, function(i, field){
              texta4 = texta4 + '<div>'+
                  '<div class="fl-spc tb-st no-bdt">'+(i+1)+'</div>' +
                  '<div class="fl-15 tb no-bdt">'+field.prod_code+'</div>' +
                  '<div class="fl-45 tb no-bdt">'+field.prod_name+'</div>' +
                  '<div class="fl-spc tb no-bdt">'+field.prod_amount+'</div>' +
                  '<div class="fl-13 tb no-bdt">'+parseFloat(field.prod_price).toFixed(2)+'</div>' +
                  '<div class="fl-13 tb no-bdt">'+parseFloat(field.prod_price*field.prod_amount).toFixed(2)+'</div>' +
                '</div>';	
                if(c < 7){
                  if(i == obj.length-1){
                    for(var j = 0 ; j < 7-c;j++){
                      texta4 = texta4 + '<div>'+
                        '<div class="fl-spc tb-st no-bdt">&emsp;</div>' +
                        '<div class="fl-15 tb no-bdt">&emsp;</div>' +
                        '<div class="fl-45 tb no-bdt">&emsp;</div>' +
                        '<div class="fl-spc tb no-bdt">&emsp;</div>' +
                        '<div class="fl-13 tb no-bdt">&emsp;</div>' +
                        '<div class="fl-13 tb no-bdt">&emsp;</div>' +
                      '</div>';	
                    }						
                    arr_a4.push(texta4);
                  }
                  c++;
                }else if(c == 7){				
                  arr_a4.push(texta4);
                  c = 1;
                  texta4 = "";
                }
            });
            for(var a = 0;a < arr_a4.length;a++){
              text = text + "<div class='ctn' style='margin-top: -8mm;'>" +
                "<div class='fl-35'>" +
                  "<img style='width: 250px; height: 150px;' src='img/logo.jpg'>" +
                "</div>" +
                '<div class="fl-spc">&emsp;</div>' +
                "<div class='fl-25' style='margin-top: 30px;'>" +
                '<h1 style="border: 1px solid #555; border-radius: 10px; padding-top: 10px; padding-bottom: 10px; background-color: #555 !important; color: white; font-size: 210%;">ใบรายการขาย</h1>' +
                '</div>' +
                '<div class="fl-20">&emsp;</div>' +
                "<div class='fl-15' style='text-align: center; margin-bottom: 30px;'>" +
                  '<h4 style="border: 1px solid black; background-color: #cccccc; padding-top: 5px; padding-bottom: 5px; width: 90%;">ต้นฉบับ</h4>' +
                '</div>' +

                '<div style=" text-align: right;">' +
                  '<p style="width: 99%;"><span class="bold">เลขที่  : </span><span>&emsp;'+obj[0].order_number+'</span></p>' +
                  '<p style="width: 99%; margin-top: -15px;"><span class="bold">วันที่  : </span>&emsp;&emsp; <span>'+date+'</span></p>' +
                  '<p style="width: 99%; margin-top: -15px;"><span class="bold">เครดิต : </span><span style="margin-left: 98px;">'+credit+'</span></p>' +
                '</div>'+
                
                '<div style=" text-align: left; margin-top: -41px;">'+
                  '&emsp; <span class="bold">สถานที่ส่งสินค้า : </span><span>&emsp;รถบริษัท DD MOTOR SPORT B-24, B-28 อาคารศรีวรจักร ถ.หลวงป้อมปราบศัตรูพ่าย</span>'+
                '</div>' +

                '<div style="margin-top: 5px;">' +
                  '<div class="fl-80 tb-st no-bdbtm" style="text-align: left;">&emsp; <span class="bold">ชื่อลูกค้า : </span><span>&emsp;'+obj[0].cus_name+'</span> &emsp;&emsp;&emsp; <span class="bold">โทร : </span><span>&emsp;'+obj[0].cus_tel+'</span></div>' +
                  '<div class="fl-9 tb no-bdbtm ccc bold">วันครบกำหนด</div>' +
                  '<div class="fl-9 tb no-bdbtm ccc bold">ทำรายการโดย</div>' +
                '</div>'+

                '<div style="margin-top: 5px;">' +
                  '<div class="fl-80 tb-st no-bdt" style="text-align: left;">&emsp; <span class="bold">ที่อยู่ : </span><span>&emsp;'+obj[0].cus_addr+'</span></div>'+
                  '<div class="fl-9 tb" style="margin-top: -1px;">'+date_ex+'</div>'+
                  '<div class="fl-9 tb" style="margin-top: -1px;">'+obj[0].user_name+'</div>'+
                '</div>' +

                '<div>'+
                  '<div class="fl-spc tb-st no-bdt ccc bold">ที่</div>'+
                  '<div class="fl-15 tb no-bdt ccc bold">รหัสสินค้า</div>'+
                  '<div class="fl-45 tb no-bdt ccc bold">รายการ</div>'+
                  '<div class="fl-spc tb no-bdt ccc bold">จำนวน</div>'+
                  '<div class="fl-13 tb no-bdt ccc bold">ราคา / หน่วย</div>'+
                  '<div class="fl-13 tb no-bdt ccc bold">จำนวนเงิน</div>' +
                '</div>'+
								arr_a4[a]
              if(a == arr_a4.length-1){
                text = text + '<div>' +
                    '<div class="fl-spc tb-st no-bdt pd-15">จำนวน</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................ กล่อง</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... ลัง</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... มัด</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................ ม้วน</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... ชิ้น</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">รวม / Total</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">'+parseFloat(obj[0].sum_price).toFixed(2)+'</div>' +
                  '</div>' +

                  '<div>' +
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">ส่วนลด / Discount</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">'+parseFloat(obj[0].total_discount).toFixed(2)+'</div>' +
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">สุทธิ / Net</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">'+parseFloat(obj[0].total_price).toFixed(2)+'</div>'+
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16 ">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">ภาษีมูลค่าเพิ่ม / Vat</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">0.00</div>'+
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt pd-15">ผู้ขายของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">คลังสินค้า/ผู้ตรวจสอบ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้ส่งของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้รับของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้มีอำนาจลงนาม</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">ทั้งสิ้น / Grand Total</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">'+parseFloat(obj[0].total_price).toFixed(2)+'</div>'+
                  '</div>'                
              }else{
                text = text + '<div>' +
                    '<div class="fl-spc tb-st no-bdt pd-15">จำนวน</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................ กล่อง</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... ลัง</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... มัด</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................ ม้วน</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... ชิ้น</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">รวม / Total</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">-</div>' +
                  '</div>' +

                  '<div>' +
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">ส่วนลด / Discount</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">-</div>' +
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">สุทธิ / Net</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">-</div>'+
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16 ">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">ภาษีมูลค่าเพิ่ม / Vat</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">-</div>'+
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt pd-15">ผู้ขายของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">คลังสินค้า/ผู้ตรวจสอบ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้ส่งของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้รับของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้มีอำนาจลงนาม</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">ทั้งสิ้น / Grand Total</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">-</div>'+
                  '</div>'               
              }
              text = text + '</div>' +
											"<div class='ctn' style='margin-top: 155mm; page-break-after: always;'>" +
												'<div>--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</div>'+
												"<div class='fl-35'>" +
													"<img style='width: 250px; height: 150px;' src='img/logo.jpg'>" +
												"</div>" +
												'<div class="fl-spc">&emsp;</div>' +
												"<div class='fl-25' style='margin-top: 30px;'>" +
												'<h1 style="border: 1px solid #555; border-radius: 10px; padding-top: 10px; padding-bottom: 10px; background-color: #555 !important; color: white; font-size: 210%;">ใบรายการขาย</h1>' +
												'</div>' +
												'<div class="fl-20">&emsp;</div>' +
												"<div class='fl-15' style='text-align: center; margin-bottom: 30px;'>" +
													'<h4 style="border: 1px solid black; background-color: #cccccc; padding-top: 5px; padding-bottom: 5px; width: 90%;">สำเนา</h4>' +
												'</div>' +

												'<div style=" text-align: right;">' +
													'<p style="width: 99%;"><span class="bold">เลขที่  : </span><span>&emsp;'+obj[0].order_number+'</span></p>' +
													'<p style="width: 99%; margin-top: -15px;"><span class="bold">วันที่  : </span>&emsp;&emsp; <span>'+date+'</span></p>' +
													'<p style="width: 99%; margin-top: -15px;"><span class="bold">เครดิต : </span><span style="margin-left: 98px;">'+credit+'</span></p>' +
												'</div>'+
												
												'<div style=" text-align: left; margin-top: -41px;">'+
													'&emsp; <span class="bold">สถานที่ส่งสินค้า : </span><span>&emsp;รถบริษัท DD MOTOR SPORT B-24, B-28 อาคารศรีวรจักร ถ.หลวงป้อมปราบศัตรูพ่าย</span>'+
												'</div>' +

												'<div style="margin-top: 5px;">' +
													'<div class="fl-80 tb-st no-bdbtm" style="text-align: left;">&emsp; <span class="bold">ชื่อลูกค้า : </span><span>&emsp;'+obj[0].cus_name+'</span> &emsp;&emsp;&emsp; <span class="bold">โทร : </span><span>&emsp;'+obj[0].cus_tel+'</span></div>' +
													'<div class="fl-9 tb no-bdbtm ccc bold">วันครบกำหนด</div>' +
													'<div class="fl-9 tb no-bdbtm ccc bold">ทำรายการโดย</div>' +
												'</div>'+

												'<div style="margin-top: 5px;">' +
													'<div class="fl-80 tb-st no-bdt" style="text-align: left;">&emsp; <span class="bold">ที่อยู่ : </span><span>&emsp;'+obj[0].cus_addr+'</span></div>'+
													'<div class="fl-9 tb" style="margin-top: -1px;">'+date_ex+'</div>'+
													'<div class="fl-9 tb" style="margin-top: -1px;">'+obj[0].user_name+'</div>'+
												'</div>' +

												'<div>'+
													'<div class="fl-spc tb-st no-bdt ccc bold">ที่</div>'+
													'<div class="fl-15 tb no-bdt ccc bold">รหัสสินค้า</div>'+
													'<div class="fl-45 tb no-bdt ccc bold">รายการ</div>'+
													'<div class="fl-spc tb no-bdt ccc bold">จำนวน</div>'+
													'<div class="fl-13 tb no-bdt ccc bold">ราคา / หน่วย</div>'+
													'<div class="fl-13 tb no-bdt ccc bold">จำนวนเงิน</div>' +
												'</div>' +
													arr_a4[a]
              if(a == arr_a4.length-1){
                text = text + '<div>' +
                    '<div class="fl-spc tb-st no-bdt pd-15">จำนวน</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................ กล่อง</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... ลัง</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... มัด</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................ ม้วน</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... ชิ้น</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">รวม / Total</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">'+parseFloat(obj[0].sum_price).toFixed(2)+'</div>' +
                  '</div>' +

                  '<div>' +
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">ส่วนลด / Discount</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">'+parseFloat(obj[0].total_discount).toFixed(2)+'</div>' +
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">สุทธิ / Net</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">'+parseFloat(obj[0].total_price).toFixed(2)+'</div>'+
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16 ">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">ภาษีมูลค่าเพิ่ม / Vat</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">0.00</div>'+
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt pd-15">ผู้ขายของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">คลังสินค้า/ผู้ตรวจสอบ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้ส่งของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้รับของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้มีอำนาจลงนาม</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">ทั้งสิ้น / Grand Total</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">'+parseFloat(obj[0].total_price).toFixed(2)+'</div>'+
                  '</div>'                
              }else{
                text = text + '<div>' +
                    '<div class="fl-spc tb-st no-bdt pd-15">จำนวน</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................ กล่อง</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... ลัง</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... มัด</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................ ม้วน</div>' +
                    '<div class="fl-12 tb no-bdt pd-15">................... ชิ้น</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">รวม / Total</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">-</div>' +
                  '</div>' +

                  '<div>' +
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">ส่วนลด / Discount</div>' +
                    '<div class="fl-13 tb no-bdt pd-15">-</div>' +
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">&emsp;</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">สุทธิ / Net</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">-</div>'+
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt no-bdbtm pd-16 ">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-14 tb no-bdt no-bdbtm pd-16">................................</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">ภาษีมูลค่าเพิ่ม / Vat</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">-</div>'+
                  '</div>'+

                  '<div>'+
                    '<div class="fl-14 tb-st no-bdt pd-15">ผู้ขายของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">คลังสินค้า/ผู้ตรวจสอบ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้ส่งของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้รับของ</div>'+
                    '<div class="fl-14 tb no-bdt pd-15">ผู้มีอำนาจลงนาม</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">ทั้งสิ้น / Grand Total</div>'+
                    '<div class="fl-13 tb no-bdt pd-15">-</div>'+
                  '</div></div>'               
              }
            }
            text = text + '</body></html>'
        }               
        }); 
        var WinPrint  = window.open();
        WinPrint.document.write(text)       
        WinPrint.document.close();
        WinPrint.focus();
        setTimeout(function() {
          WinPrint.print();
          WinPrint.close();
        }, 250);  
    }

        function printRecep(index){
      var text = ""
      var text2 = ""
      var text3 = ""
      $.ajax({
          type: "POST",
          url:"php/get_bill_info4print.php",    
          data:{'bill_id' : index},
          async:false,                            
          beforeSend: function(){
            EasyLoading.show({                           
              text: "กำลังโหลด"
            });
          },             
          success: function(data){  
            EasyLoading.hide();
            var obj = jQuery.parseJSON(data);
            var dt = obj[0].date_time.split(" ");
            var time = dt[1];
            var d = dt[0].split("-");
            var date = d[2] + "/" + d[1] + "/" + d[0]; 
            text = text + "<html><head><meta charset='utf-8'><link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css' integrity='sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T' crossorigin='anonymous'>" +
              "<style>@page {size: auto; margin: 0mm;} body{line-height: 1.5; font-size: 0.9em; } .title{margin-bottom: 0.1em;} .line{text-decoration: underline;} .price, .no{letter-spacing: -0.05em;} .items{margin-bottom: 5px;}</style></head><body>" +
              "<div style='width: 7cm;'>"+
											"<div class='col-12 text-center'>DD MOTOR SPORT</div>"+
											"<div class='col-12 text-center'>B-24, B-28 อาคารศรีวรจักร ถ.หลวงป้อมปราบศัตรูพ่าย</div>"+
											"<div class='col-12 text-center'>โทร. 02-2265280 , 02-2222437</div>"+
											"<div class='col-12 text-center line' style='margin-top: 0.5em; margin-bottom: 0.5em;'>ใบเสร็จรับเงิน</div>"+						
                      "<div class='row justify-content-center title'>" +
                        "<div class='col-4 text-right'>ลูกค้า : </div>" +
                        "<div class='col-6 text-center'>"+obj[0].cus_name+"</div>" +
                      "</div>" +
                      "<div class='row justify-content-center title'>" +
                        "<div class='col-4 text-right'>ประเภท : </div>" +
                        "<div class='col-6 text-center'>"+obj[0].payment_type+"</div>" +
                      "</div>" +
                      "<div class='row justify-content-center title'>" +
                        "<div class='col-4 text-right'>เลขที่บิล : </div>" +
                        "<div class='col-6 text-center'>"+obj[0].order_number+"</div>" +
                      "</div>" +
                      "<div class='row justify-content-center title'>" +
                        "<div class='col-4 text-right'>วันที่ : </div>" +
                        "<div class='col-3 text-right'>"+date+"  </div>" +
                        "<div class='col-3'>"+time+"</div>" +
                      "</div>" +								
											
											"<hr style='width: 90%; border-top: 1px dashed; border-bottom: none; margin-top: 5px;'>"+
                      "<div class='row justify-content-center' style='margin-bottom: 5px;'>" +
                        "<div class='col-2 text-center line'>จำนวน</div>" +
                        "<div class='col-6 text-center line'>รายการ</div>" +
                        "<div class='col-4 text-center line'>ราคา</div>" +
                      "</div>"
            $.each(obj, function(i, field){             
              text2 = text2 +  "<div class='row items'>" +
                                "<div class='col-2 no text-center'>"+field.prod_amount+"</div>" +
                                "<div class='col-6 text-center'>"+field.prod_name+"</div>" +
                                "<div class='col-4 price text-center'>"+field.prod_price+"</div>" +
                              "</div>"         
            });
            text3 = text3 + "<hr style='width: 90%; border-top: 1px; border-top: 1px dashed; border-bottom: none; margin-top: 0;'>"+
											"<div class='row justify-content-center title'>"+
                        "<div class='col-4 text-right'>ราคารวม : </div>" +
											  "<div class='col-6 text-center'>"+obj[0].sum_price+" บาท</div>"+
											"</div>"+
                      "<div class='row justify-content-center title'>"+
                        "<div class='col-4 text-right'>ส่วนลด : </div>" +
											  "<div class='col-6 text-center'>"+obj[0].total_discount+" บาท</div>"+
											"</div>"+
                      "<div class='row justify-content-center title'>"+
                        "<div class='col-4 text-right'>สุทธิ : </div>" +
											  "<div class='col-6 text-center'>"+obj[0].total_price+" บาท</div>"+
											"</div>"+
                      "<div class='row justify-content-center title'>"+
                        "<div class='col-4 text-right'>รับ / ทอน : </div>" +
											  "<div class='col-4 text-right'>"+obj[0].get_price+" บาท</div>"+
                        "<div class='col-4 text-right'>"+obj[0].chng+" บาท</div>"+
											"</div>"+
											"<div class='col-12 text-center'>พนักงานขาย : "+obj[0].user_name+"</div>"+
										"</div></body></html>"
        }               
        });
        var WinPrint  = window.open();
        WinPrint.document.write(text)
        WinPrint.document.write(text2)
        WinPrint.document.write(text3)
        WinPrint.document.close();
        WinPrint.focus();
        setTimeout(function() {
          WinPrint.print();
          WinPrint.close();
        }, 250);
    }

        function logout(){
			localStorage.clear();
		}
        
  </script>
</head>

<body>
    <div class="container-fullwidth justify-content-center">
        <nav class="navbar navbar-expand-md navbar-dark">
            <div class="collapse navbar-collapse justify-content-md-center" id="navbarCollapse">
                <h3 id="nav-title">รายงานการขาย</h3>
            </div>
        </nav>
        <div class="container">
            <div class="row" style="margin-top: 2px;">
                <div class="col-12 text-center">
                    <a href="web_sale.html" class="mgr-20">ขายสินค้า</a>
                    <a href="web_import.html" class="mgr-20">นำสินค้าเข้า</a>
                    <a href="web_stock.html" class="mgr-20">เช็คสต๊อก</a>
                    <a href="web_export.html" class="mgr-20">สินค้าออกโกดัง</a>                  
                    <a href="web_select.html" class="mgr-20 active">รายการย้อนหลัง</a>
                    <a href="web_qrprint.html" class="mgr-20">พิมพ์คิวอาร์</a>
                    <a href="" class="mgr-20" onclick="logout()">ออกจากระบบ</a>
                </div>
            </div>
        </div><br><br>
        <div class="container-fullwidth">
            <div class="input-group row justify-content-center" style="margin-bottom: 4%; margin-left: 0.5%">
                <button type="text" class="btn btn-lg btn-secondary text-center" style="width: 60%;">เลือกวันที่</button>
                <button id="dpicker"  class="btn btn-outline-secondary" type="button" style="margin-left: 10px;" data-toggle="datepicker">
                    <i class="fa fa-calendar-alt"></i>
                </button>
            </div>
        </div>
        <div class="container-fullwidth">
            <div id="ctn-top" class="row justify-content-center" style="margin-bottom: 4%;">               
                              
            </div>
        </div>
        <div class="container-fullwidth">
            <div class="row justify-content-center">
                <div class="col-4 text-center">
                    <h4>เลขที่บิล</h4>
                </div>
                <div class="col-2 text-center">
                    <h4>ผู้ทำรายการ</h4>
                </div>
                <div class="col-3 text-center">
                    <h4>ราคารวม</h4>
                </div>
                <div class="col-3 text-center">
                    <h4>กำไร</h4>
                </div>
            </div>
        </div>
        <hr style="width: 75%; margin-top: 0;"> <br>
        <div id="ctn-append" class="container-fullwidth">
            <ul id="myUL">
             
            </ul>
        </div>
    </div>
     <!-- Modal -->
     <div class="modal fade" id="printModal" tabindex="-1" role="dialog" aria-labelledby="printModal" aria-hidden="true" style="margin-top: 25%;">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="printModal">เลือกรูปแบบการพิมพ์</h5>
            </div>
            <div class="modal-footer justify-content-end">
              <button id="btn-a4" type="button" class="btn btn-warning">ใบรายการขาย(A4) <i class="fas fa-file-invoice"></i> </button>
              <button id="btn-recep" type="button" class="btn btn-primary">ใบเสร็จ <i class="fas fa-receipt"></i> </button>
              <button style="margin-left: 30px;" type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close">ปิด <i class="fas fa-times"></i> </button>
            </div>
          </div>
        </div>
      </div>
</body>

</html>