<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>รายงานบิล</title>

    <!-- Bootstrap Import -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css" integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ"
        crossorigin="anonymous">

    <!-- Super cool dialog-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js"></script>

    <!-- Loading -->
    <link rel="stylesheet" href="css/easy-loading.css">
    <script src="js/easy-loading.js"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Prompt" rel="stylesheet">
    <!-- Main -->
    <link href="css/untitled.css" rel="stylesheet">
    <style>
        body{color: #666;}
    a{ color: #999;}
    a:hover{color: #666;}
    .active{color: #666;}
    .ipt-odd, .ipt-even{
      padding-top: 1%; padding-bottom: 1%; color: #fff; margin-bottom: 1%; cursor: pointer;
    }
    .ipt-odd{
      background-color: #999;
    }
    .ipt-even{
      background-color: #858585;
    }
    h5{
      letter-spacing: 2px;
    }
    ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }
  </style>
  <script>
    var start = start_d = start_s = 0;
    var bool = bool_d = bool_s = false;
    $(document).ready(function(){       
      $('#datepicker-from').duDatepicker(({format: 'dd/mm/yy', theme: 'red', cancelBtn: true, maxDate: "today"})).on('datechanged', function(e){
        console.log(e.date);
        $("#date").text(e.date);
        if(e.date != null){
          e.date = new Date();
        }
        $("#datepicker-to").trigger('click');
      });

      $('#datepicker-to').duDatepicker(({format: 'dd/mm/yy', theme: 'red', cancelBtn: true, maxDate: "today"})).on('datechanged', function(e){
        console.log(e.date);
        $("#date").append(" - " + e.date);
        $("#date_row").prop('hidden', false);
        $("#search_row").prop('hidden', true);
        start_d = 0;
        bool_d = false;
        $("#myS").prop('hidden', true);
        $("#myUL").prop('hidden', true);
        $("#myD").prop('hidden', false);
        $("#myD").empty();
        $("#i-back").attr("onclick","showUL()");
        search_date();
      });
      get_import();

      //scroll to bottom
      $(window).on("scroll", function() {
        var scrollHeight = $(document).height();
        var scrollPosition = $(window).height() + $(window).scrollTop();
        if ((scrollHeight - scrollPosition) / scrollHeight === 0) {          
          if(!$("#myUL").prop('hidden')){
            if(bool){
              return 0;
            }
            get_import();            
          }else if(!$("#myD").prop('hidden')){
            if(bool_d){
              return 0;
            }
            search_date();
          }else if(!$("#myS").prop('hidden')){
            if(bool_s){
              return 0;
            }
            get_import_s();
          }
        }
      });      
    });
    
    $(document).keydown(function(objEvent) {
      if (objEvent.keyCode == 13) {  //enter pressed
        objEvent.preventDefault();           
        search();        
      }         
    })

    function showUL(){
      $("#myS").prop('hidden', true);
      $("#myUL").prop('hidden', false);
      $("#myD").prop('hidden', true);
      $("#search_row").prop('hidden', true);
      $("#date_row").prop('hidden', true);
      $("#i-back").attr("onclick","transition_page_back('index.html?menu=3'); window.location = 'index.html?menu=3';");
    }

    function get_import(){
      $.ajax({
        type: "POST",
        url:"http://ddaccessory.trueddns.com:24330/dd-shop/php/get_import.php",
        data: {'start': start},       
        beforeSend: function(){
            $(".overlay").prop('hidden', false);
        },                       
        success: function(data){ 
          $(".overlay").prop('hidden', true);  
          var obj = jQuery.parseJSON(data);
          if(obj[0] == "last"){
            bool = true
          }                        
          $.each(obj, function(i, field){
            if(i > 0){
              var txt = field.date_time.split(" ");
              var txt2 = txt[0].split("-");
              var date = txt2[2] + "/" + txt2[1] + "/" + txt2[0].substr(2);
              $('#myUL').append('<li> <div class="row" onclick="import_info('+field.stock_id+')">'+
                '<div class="col-4 text-center no-pd">' +
                  '<p>'+field.stock_number+'</p>' +
                '</div>' +
                '<div class="col-3 text-center no-pd">' +
                  '<p>'+date+'</p>' +
                '</div>' +
                '<div class="col-5 text-center no-pd">' +
                  '<p>'+field.ware_name+'</p>' +
                '</div>' +
              '</div><hr></li>');   
            }                                               
          });                                          
        }               
      });
      start += 20;
    }

    function import_info(arg){
      transition_page_next('import_info.html?id='+arg);
      window.location = 'import_info.html?id='+arg;
    }

    function show_search(){
      if($("#search_row").is(':visible')){
        $("#search_row").prop('hidden', true);
        if(!$("#myD").prop('hidden')){
          $("#date_row").prop('hidden', false);
        }
      }else{
        $("#search_row").prop('hidden', false);
        $("#date_row").prop('hidden', true);
      }
    }

    var val;
    function search(){
      if($('#search_import').val() == ""){
        return 0;
      }
      $('#search_import').blur();
      val = $('#search_import').val();
      start_s = 0;
      bool_s = false;
      $("#myS").prop('hidden', false);
      $("#myUL").prop('hidden', true);
      $("#myD").prop('hidden', true);
      $("#myS").empty();
      $("#i-back").attr("onclick","showUL()");
      get_import_s();
    }

    function get_import_s(){
      $.ajax({
        type: "POST",
        url:"http://ddaccessory.trueddns.com:24330/dd-shop/php/get_import.php",
        data: {'start': start_s, 'value' : val},
        beforeSend: function(){
            $(".overlay").prop('hidden', false);
        },                       
        success: function(data){ 
          $(".overlay").prop('hidden', true);  
          var obj = jQuery.parseJSON(data);
          if(obj[0] == "last"){
            bool_s = true
          }
          $.each(obj, function(i, field){
            if(i > 0){
              var txt = field.date_time.split(" ");
              var txt2 = txt[0].split("-");
              var date = txt2[2] + "/" + txt2[1] + "/" + txt2[0].substr(2);
              $('#myS').append('<li> <div class="row" onclick="import_info('+field.stock_id+')">'+
                '<div class="col-4 text-center no-pd">' +
                  '<p>'+field.stock_number+'</p>' +
                '</div>' +
                '<div class="col-3 text-center no-pd">' +
                  '<p>'+date+'</p>' +
                '</div>' +
                '<div class="col-5 text-center no-pd">' +
                  '<p>'+field.ware_name+'</p>' +
                '</div>' +
              '</div><hr></li>');     
            }                                                
          });                                         
        }               
      });
      start_s += 20;
    }

    function search_date(){
      txt = $("#date").text().split("-");
      temp = txt[0].split("/");
      date =  "20" + temp[2] + "-" + temp[1] + "-" + temp[0];
      date = date.replace(/\s+/g, '');
      date = date + " 00:00:00";

      temp = txt[1].split("/");
      date_to =  "20" + temp[2] + "-" + temp[1] + "-" + temp[0];
      date_to = date_to.replace(/\s+/g, '');
      date_to = date_to + " 23:59:59";

      $.ajax({
        type: "POST",
        url:"http://ddaccessory.trueddns.com:24330/dd-shop/php/get_import.php",         
        data:{'date' : date, 'date_to' : date_to ,'start' : start_d},
        beforeSend: function(){
          $(".overlay").prop('hidden', false);
        },                       
        success: function(data){ 
          $(".overlay").prop('hidden', true);  
          var obj = jQuery.parseJSON(data);
          if(obj[0] == "last"){
            bool_d = true;
          }                              
          $.each(obj, function(i, field){
            if(i > 0){
              var txt = field.date_time.split(" ");
              var txt2 = txt[0].split("-");
              var date = txt2[2] + "/" + txt2[1] + "/" + txt2[0].substr(2);
              $('#myD').append('<li> <div class="row" onclick="import_info('+field.stock_id+')">'+
                '<div class="col-4 text-center no-pd">' +
                  '<p>'+field.stock_number+'</p>' +
                '</div>' +
                '<div class="col-3 text-center no-pd">' +
                  '<p>'+date+'</p>' +
                '</div>' +
                '<div class="col-5 text-center no-pd">' +
                  '<p>'+field.ware_name+'</p>' +
                '</div>' +
              '</div><hr></li>'); 
            }                                      
          });                                         
        }               
      });  
      start_d += 20;          
    }

  </script>
</head>

<body>
    <div class="container-fullwidth justify-content-center">
        <nav class="navbar navbar-expand-md navbar-dark">
            <div class="collapse navbar-collapse justify-content-md-center" id="navbarCollapse">
                <h3 id="nav-title">รายงานบิล</h3>
            </div>
        </nav>
        <div class="container">
            <div class="row" style="margin-top: 2px;">
                <div class="col-12 text-center">
                    <a href="web_sale.html" class="mgr-20">ขายสินค้า</a>
                    <a href="web_import.html" class="mgr-20">นำสินค้าเข้า</a>
                    <a href="web_stock.html" class="mgr-20">เช็คสต๊อก</a>
                    <a href="web_export.html" class="mgr-20">สินค้าออกโกดัง</a>                   
                    <a href="web_select.html" class="mgr-20 active">รายการย้อนหลัง</a>
                    <a href="web_qrprint.html" class="mgr-20">พิมพ์คิวอาร์</a>
                    <a href="" class="mgr-20" onclick="logout()">ออกจากระบบ</a>
                </div>
            </div>
        </div><br><br>
        <div class="container-fullwidth">
            <div class="input-group row justify-content-center" style="margin-bottom: 4%; margin-left: 0.5%">
                <input id="input-search" onkeyup="search();" type="text" class="form-control-lg text-center"
                    placeholder="ค้าหา เลขที่นำเข้า / โกดัง" style="width: 60%;">
                <button  class="btn btn-outline-secondary" type="button" style="margin-left: 10px;">
                    <i class="fa fa-calendar-alt"></i>
                </button>
            </div>
        </div>
        <div class="container-fullwidth">
            <div class="row justify-content-center">
                <div class="col-4 text-center">
                    <h4>เลขที่นำเข้า</h4>
                </div>
                <div class="col-3 text-center">
                    <h4>วันที่</h4>
                </div>
                <div class="col-3 text-center">
                    <h4>โกดัง</h4>
                </div>
            </div>
        </div>
        <hr style="width: 75%; margin-top: 0;"> <br>
        <div id="ctn-append" class="container-fullwidth">
            <ul id="myUL">
                <li>
                    <div class="row justify-content-center ipt-odd">
                        <div class="col-4 text-center">
                            <h5>IMP18-00054</h5>
                        </div>
                        <div class="col-3 text-center">
                            <h5>03/10/18</h5>
                        </div>
                        <div class="col-3 text-center">
                            <h5>โกดัง A</h5>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="row justify-content-center ipt-even">
                        <div class="col-4 text-center">
                            <h5>IMP19-00054</h5>
                        </div>
                        <div class="col-3 text-center">
                            <h5>03/10/18</h5>
                        </div>
                        <div class="col-3 text-center">
                            <h5>โกดัง B</h5>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</body>

</html>