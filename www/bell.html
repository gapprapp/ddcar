<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Home</title>
    <!-- Bootstrap Import -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/jquery.easing.1.3.min.js"></script>
    <script type="text/javascript" src="js/transition.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
    <script src="cordova.js"></script>
    <script type="text/javascript" src="js/scanqr.js"></script>
    <script type="text/javascript" src="js/jquery.touchSwipe.min.js"></script>    

    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/jquery-confirm.css">   
    <link rel="stylesheet" href="css/loading.css">

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Prompt" rel="stylesheet">

    <style>
      .yellow{
        color: #ffbb33;
      }
      .red{
        color: #d63232;
      }
      #title{
        color: #666;
        letter-spacing: 1px;
        font-weight: bold;
      }
      .nopd{
        padding-left: 0;
        padding-right: 0;
      }
      .info{
        font-size: 95%;
      }
    </style>
    <script>
      start = 0;
      $(document).ready(function () {
        if(localStorage.bell){
          $('.dot').prop('hidden',false);
        }
        $.ajax({
          type: "POST",
          url:localStorage.pathServer + "php/get_status_prod.php", 
          data: {'start': start},         
          beforeSend: function(){
            $(".overlay").prop('hidden', false);
          },             
          success: function(data){  
            $(".overlay").prop('hidden', true); 
            var obj = jQuery.parseJSON(data); 
            if(obj.length > 0){
              $.each(obj, function(i, field){ 
                if(field.status == "warning"){
                  $('#in-ctn').append('<div class="row info">' +
                      '<div class="col-1 text-center">' +
                        '<i class="fas fa-circle yellow"></i>' +
                      '</div>' +
                      '<div class="col-8 text-center">'+field.prod_name+'</div>' +
                      '<div class="col-3 text-center nopd">'+obj[i][3]+'</div>' +
                    '</div><hr class="mgem1">');
                }else if(field.status == "danger"){
                  $('#in-ctn').append('<div class="row info">' +
                      '<div class="col-1">' +
                        '<i class="fas fa-circle red"></i>' +
                      '</div>' +
                      '<div class="col-8 text-center">'+field.prod_name+'</div>' +
                      '<div class="col-3 text-center nopd">'+obj[i][3]+'</div>' +
                    '</div><hr class="mgem1">');
                }                                                                                 
              });
            }else{
              update_bell();
            }
          }               
        });
        start += 20;

        $("#in-ctn").scroll(function() {
          if($("#in-ctn").scrollTop() > $("#in-ctn").height()) { 
            $.ajax({
              type: "POST",
              url:localStorage.pathServer + "php/get_status_prod.php", 
              data: {'start': start},         
              beforeSend: function(){
                $(".overlay").prop('hidden', false);
              },             
              success: function(data){  
                $(".overlay").prop('hidden', true); 
                var obj = jQuery.parseJSON(data); 
                if(obj.length > 0){
                  $.each(obj, function(i, field){ 
                    if(field.status == "warning"){
                      $('#in-ctn').append('<div class="row info">' +
                          '<div class="col-1 text-center">' +
                            '<i class="fas fa-circle yellow"></i>' +
                          '</div>' +
                          '<div class="col-8 text-center">'+field.prod_name+'</div>' +
                          '<div class="col-3 text-center nopd">'+obj[i][3]+'</div>' +
                        '</div><hr class="mgem1">');
                    }else if(field.status == "danger"){
                      $('#in-ctn').append('<div class="row info">' +
                          '<div class="col-1">' +
                            '<i class="fas fa-circle red"></i>' +
                          '</div>' +
                          '<div class="col-8 text-center">'+field.prod_name+'</div>' +
                          '<div class="col-3 text-center nopd">'+obj[i][3]+'</div>' +
                        '</div><hr class="mgem1">');
                    }                                                                                 
                  });
                }
              }               
            });
            start += 20;
          }
        });               
      });

      function update_bell(){
        $.ajax({ 
          type: "GET",
          url:localStorage.pathServer + "php/update_bell.php",
          beforeSend: function(){
              $(".overlay").prop('hidden', false);
          },                       
          success: function(data){ 
            $(".overlay").prop('hidden', true); 
            if(data == "fail"){
              console.log('error');
            }else{
              $('.dot').prop('hidden',true);              
            }
          }               
        }); 
      }
      
    </script>
</head>

<body>
    <!-- Loading -->
    <div class="overlay" hidden><div class="loading"></div></div> 

    <!-- big container -->
    <div id="big-ctn" class="container-fullwidth justify-content-center">
      <!-- Nav menu top -->
      <div class="row navs align-items-center mgem1o5 fixed-top">
        <div class="col-2 text-center" onclick="transition_page_back('index.html'); window.location = 'index.html';">
          <i id="i-back" class="fas fa-angle-left"></i>
        </div>
        <div class="col-8 text-center">
          <h5 id="h5-title">แจ้งเตือน</h5>
        </div>
      </div>

      <div class="row fixed-top" style="margin-top: 4.5em;">
        <div class="col-1"></div>
        <div id="title" class="col-8 text-center">ชื่อสินค้า</div>
        <div id="title" class="col-3 text-center nopd">คงเหลือ</div> 
      </div><hr class="mgem1" style="margin-top: 6.3em; width: 98%;">

      <div id="in-ctn" class="container-fullwidth" style="margin-top: 1.5em !important; height: calc(100vh - (4em + 100px)) !important;">
        

        <!-- Test scroll -->
        
        <!-- <div class="row mgem1">
          <div class="col-1 text-center"></div>
          <div class="col-8 text-center">ชื่อสินค้า</div>
          <div class="col-3 text-center nopd">0</div>
        </div>-->
      </div>
        
        <!-- Nav menu bottom -->
      <div class="row fixed-bottom navs">
        <div class="col-3 text-center" onclick="transition_page_back('index.html'); window.location = 'index.html';">
          <i id="i-home" class="fas fa-home menu"></i>
        </div>
        <div class="col-3 text-center" onclick="transition_page_next('bell.html'); window.location ='bell.html';">
          <div class="dot" hidden></div>
          <i id="i-bell" class="fas fa-bell menu"></i>
        </div>
        <div class="col-3 text-center" onclick="scan();">
          <i id="i-qrcode" class="fas fa-qrcode menu"></i>
        </div>
        <div class="col-3 text-center" onclick="transition_page_next('other.html'); window.location = 'other.html';">
          <i id="i-bars" class="fa fa-bars menu"></i>
        </div>
      </div>
    </div>
    <!-- End big container -->  
</body>

</html>